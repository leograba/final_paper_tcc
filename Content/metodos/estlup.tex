Devido à necessidade de adicionar lúpulos à receita em proporções e tempos predefinidos, foi necessário o projeto de uma estrutura automática de adição de lúpulos. Em função das inúmeras possibilidades de combinações de lúpulos e temporizações, a escolha natural do projeto foi uma estrutura que permita esta flexibilidade --- uma caixa com oito compartimentos separados, que permite a adição sequencial destes insumos. Com base em um pacote de lúpulos em \textit{pellets} de 50g, estimou-se que seu volume é de $160cm^3$ e, sabendo-se que uma receita de 20l dificilmente utiliza uma quantidade maior do que 400g de lúpulos, a decisão tomada foi a de que cada um dos 8 compartimentos deveria ter os $160cm^3$ necessários para acomodar 50g. Para confirmar que 400g é uma quantidade razoável, foi seguido o cálculo de IBU de \cite{palmer}, detalhado no apêndice \ref{Apêndice C}.

Fixando a altura do compartimento em 10,0cm foram escolhidos valores de comprimento e largura de 16,0cm e 8,0cm respectivamente, assumindo inicialmente que as paredes das divisórias tem espessura desprezível. A equação para volume de um prisma e a escolha das dimensões são demonstradas em \ref{eq_hop_vini}:

\begin{subequations}
	\label{eq_hop_vini}
	\begin{align}
		V &= l\cdot w\cdot h = V_{50g}\cdot 8 \\
		&= l\cdot w\cdot 10 = 160\cdot 8 \nonumber \\
		l\cdot w\cdot &= 128, fixando \quad l = 16cm \quad \therefore \nonumber \\
		w &= 128/16 = 8cm \quad e \\
		w_{compartimento} &= l/8 = 16/8 = 2cm
	\end{align}
\end{subequations}

Posteriormente aos cálculos de \ref{eq_hop_vini}, durante o projeto no software FreeCAD, observou-se que a assumpção de espessura desprezível é falsa e um retrabalho nas medidas do compartimento levou às dimensões externas finais de 18,0cm x 8,4cm x 10,0cm; as paredes externas tendo espessura de 3,0mm e as internas de 2,0mm. A figura \ref{caixa_cinza} esboça as dimensões externas da caixa e a figura \ref{corpo_hopbox} apresenta o corpo da estrutura.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.35]{./Resources/estLup/caixa_lupulos(1).pdf}
	\captionsetup{justification=centering}
	\caption[Dimensões da estrutura de adição de lúpulos]{Dimensões da estrutura de adição de lúpulos}
	\label{caixa_cinza}
\end{figure}

\begin{figure}[H]
	\centering
	\begin{subfigure}{.46\textwidth}
		\centering
		\includegraphics[height=7.5cm]{./Resources/estLup/caixa_lupulos(2).pdf}
		\caption{Vista superior}
		\label{corpo_hopbox:1}
	\end{subfigure}
	\begin{subfigure}{.46\textwidth}
		\centering
		\includegraphics[height=7.5cm]{./Resources/estLup/caixa_lupulos(3).pdf}
		\caption{Vista axiométrica}
		\label{corpo_hopbox:2}
	\end{subfigure}
	\captionsetup{justification=centering}
	\caption[Corpo da estrutura de adição de lúpulos]{Corpo da estrutura de adição de lúpulos}
	\label{corpo_hopbox}
\end{figure}

Foram projetadas duas portinholas: uma na face superior da caixa, para reabastecimento manual dos lúpulos, com uma alça e fixada na caixa por dois pinos, de modo que a abertura desta tampa é um movimento de rotação e; uma na face inferior para adição automática, de correr, de modo que a abertura é um movimento de translação; ambas estão ilustradas na figura \ref{tampas_hopbox}.

\begin{figure}[H]
	\centering
	\begin{subfigure}{.46\textwidth}
		\centering
		\includegraphics[height=7.5cm]{./Resources/estLup/caixa_lupulos(4).pdf}
		\caption{Tampa manual para reabastecimento}
		\label{tampas_hopbox:1}
	\end{subfigure}
	\begin{subfigure}{.46\textwidth}
		\centering
		\includegraphics[height=7.5cm]{./Resources/estLup/caixa_lupulos(5).pdf}
		\caption{Tampa para adição automática dos lúpulos}
		\label{tampas_hopbox:2}
	\end{subfigure}
	\captionsetup{justification=centering}
	\caption[Tampas da estrutura de adição de lúpulos]{Tampas da estrutura de adição de lúpulos}
	\label{tampas_hopbox}
\end{figure}

Duas varetas de comprimento $l_1$ e $l_2$ são ligadas ao encaixa da tampa de correr, representada em azul na figura \ref{tampas_hopbox} (b), e a elas é acoplado um servo-motor cujo ângulo de operação $\theta$ define a abertura --- ou deslocamento --- da tampa, definido por $d$. A figura \ref{varetas} esquematiza as ligações.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.1]{./Resources/estLup/esquema-varetas.jpg}
	\captionsetup{justification=centering}
	\caption[Esquema de ligação das varetas à tampa de correr]{Esquema de ligação das varetas à tampa de correr}
	\label{varetas}
\end{figure}

Sendo o comprimento da tampa igual a $l_3$, a condição na equação \ref{eq_varetas} deve ser satisfeita para que a excursão máxima de abertura da caixa possa ser atingida. É possível demonstrar com o auxílio da Lei dos Cossenos, em \ref{eq_cossenos} que $l_1 = l_2 = l$ para que a mínima abertura da caixa possa ser atingida.

\begin{align}
	\label{eq_varetas}
	l_1 + l_2 \geq l_3
\end{align}

\begin{align}
	\label{eq_cossenos}
	&l_2^2 = d^2 + l_1^2 - 2dl_1\cdot cos(\theta) \\
	&se \quad \theta = 90\si{\degree} \rightarrow d = 0 \therefore \nonumber\\
	\label{res_cossenos}
	&l_2^2 = l_1^2 \rightarrow l_2 = l_1 = l
\end{align}

A taxa máxima de deslocamento em função do ângulo do servo motor é expressa em \ref{eq_desl}:

\begin{align}
	\label{eq_desl}
	\frac{dl_3}{d\theta} = \frac{2l}{90\si{\degree}}
\end{align}

Entretanto, quanto maior o valor desta taxa, menor é a resolução de abertura da caixa, portanto obtem-se que o menor valor possível de $l$, a partir da equação \ref{eq_varetas} é $l = l_3/2$. Assim sendo, a taxa de deslocamento calculada a partir da equação \ref{eq_desl} é de $2mm/\si{\degree}$.

Embora o valor teórico de $\theta$ seja $90\si{\degree}$, na prática, devido ao encaixe entre tampa e vareta não ser na extremidade, este valor é reduzido. Tal fato não deve ser negligenciado, uma vez que isto pode forçar a operação do servo-motor ou quebrar alguma das peças do sistema. Sabe-se pelo projeto executado no FreeCAD que a distância da borda ao encaixe da tampa é de 2,3cm e portanto, com o auxílio da Lei dos Cossenos, obtém-se que $\theta_{max} = 82\si{\degree}$. Quanto ao valor mínimo não há preocupação, já que a abertura da caixa terá uma excursão reduzida em 2,3cm com relação ao seu comprimento. As varetas não foram calculadas novamente para corrigir esta excursão pois a redução foi considerada uma boa prática, que evita que a tampa se desacople da caixa. A figura \ref{completa_hopbox} apresenta o esquema completo de construção da estrutura de adição de lúpulos.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.25]{./Resources/estLup/final.jpg}
	\captionsetup{justification=centering}
	\caption[Estrutura de adição de lúpulos]{Estrutura de adição de lúpulos}
	\label{completa_hopbox}
\end{figure}

\subsection{Controle do servo-motor}

Servomotor é um dispositivo de conversão eletromecânica que surgiu da necessidade de controle de posição angular de um motor de corrente contínua --- tanto é que um servomotor é um motor DC com controle e realimentação, ou seja, um dispositivo de malha fechada. Além da tensão de alimentação, o servomotor recebe um sinal de controle proporcional à posição desejada do eixo e atua no motor DC até que, através do ramo de realimentação, atinja-se a posição angular de entrada. A Figura \ref{servo_desmontado} apresenta um servomotor desmontado e a identificação de suas partes principais.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.50]{./Resources/servo/partes.png}
	\captionsetup{justification=centering}
	\caption[Servo-motor desmontado]{Servo-motor desmontado}
	\label{servo_desmontado}
\end{figure}

Observa-se que o circuito de controle é um circuito integrado, porém não há ampla documentação acerca de sua arquitetura interna; já o potenciômentro é o elemento sensor do conjunto, cujo objetivo é fornecer a posição angular do eixo através da variação de sua resistência. O motor é a planta do sistema de controle, convertendo energia elétrica em rotação do eixo. O conjunto de engrenagens é responsável por aumentar o torque do mesmo, com a diminuição da velocidade de rotação.

A caracterização funcionamento do servomotor foi realizada em 4 partes: elaboração do código de controle para 8051; simulação no software Proteus ISIS; ensaio para determinar os valores práticos de operação do servomotor e; nova simulação no software Proteus ISIS. O código para AT89S52 --- compatível com 8051 --- é apresentado na caixa \ref{at_servo_code} do apêndice \ref{apendice_servo} e o diagrama esquemático do circuito de teste e simulação na figura \ref{circuito_servo}. O uso do AT89S52 se deve ao fato de que o uso do PWM com a BBB ainda não estava desenvolvido neste ponto do projeto, porém posteriormente a interface entre servo-motor e BBB foi realizada --- e os resultados estão descritos na seção \ref{aciona_results}.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.23]{./Resources/servo/diagrama_esquematico.png}
	\captionsetup{justification=centering}
	\caption[Circuito de caracterização do servo-motor]{Circuito de caracterização do servo-motor}
	\label{circuito_servo}
\end{figure}

Observa-se a necessidade de um buffer entre o microcontrolador AT89S52 e o servomotor, pois a corrente requisitada pelo pino de controle do servo é maior do que a corrente máxima fornecida pelo \si{\micro}C. 

Os resultados da caracterização do funcionamento do servo-motor estão documentados no apêndice \ref{apendice_servo}.











