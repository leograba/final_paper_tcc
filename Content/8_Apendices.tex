\chapter{Códigos-fonte da interface de usuário}
\label{Apêndice A}

Códigos em elaboração.

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %

\chapter{Scripts Python}
\label{codigos_python}

\section{Módulo com as funções para \textit{log} da temperatura}
\input{./SourceCodes/temp.py.tex}

\section{Script para plotagem de gráfico}
\input{./SourceCodes/grafico.py.tex}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %

\chapter{Códigos-fonte Node.js}
\label{codigos_nodejs}

\section{Código-fonte raiz da aplicação em Node.js}
\input{./SourceCodes/controle.tex}

\section{Módulo de gerenciamento de GPIO e PWM}
\input{./SourceCodes/gpio_cfg.tex}

\section{Módulo de roteamento do servidor web}
\input{./SourceCodes/routes.tex}

\section{Módulo de registros e verificações em geral}
\input{./SourceCodes/log_check_misc.tex}

\section{Módulo de controle do processo de brassagem}
\input{./SourceCodes/ctrl.tex}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %

\chapter{Códigos-fonte da aplicação web}
\label{codigos_web}

\section{Módulo PHP que cria a barra de navegação da interface web}
\input{./SourceCodes/header_php.tex}

\section{Função que passa a URL da página atual para um módulo em PHP}
\input{./SourceCodes/header_js.tex}

\section{Página inicial}
\input{./SourceCodes/index.tex}

\section{Página \textit{sobre}}
\input{./SourceCodes/about.tex}

\section{Página de estatísticas}
\input{./SourceCodes/stats.tex}

\section{Gráfico dinâmico de temperatura}
\input{./SourceCodes/dyn_graph.tex}

\section{Página gerenciadora de receitas da interface web}
\input{./SourceCodes/listrecipes.tex}

\section{Funcões auxiliares do gerenciador de receitas}
\input{./SourceCodes/listrecipes_js.tex}

\section{Código HTML do editor de receitas}
\input{./SourceCodes/newrecipe.tex}

\section{Código PHP do editor de receitas}
\input{./SourceCodes/newrecipe_php.tex}

\section{Código javascript do editor de receitas}
\input{./SourceCodes/newrecipe_js.tex}

\section{Gerenciador de brassagem}
\input{./SourceCodes/startrecipe.tex}

\section{Painel de controle de brassagem}
\input{./SourceCodes/control_php.tex}

\section{CSS do formulário}
\input{./SourceCodes/form.tex}

\section{CSS específico para alguns botões}
\input{./SourceCodes/buttons.tex}

\section{CSS do template da aplicação web}
\input{./SourceCodes/config.tex}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %

\chapter{Arquivos de configuração do sistema}
\label{Apêndice B}

\section{Arquivo de configuração de rede}
\input{./SourceCodes/etc-network-interfaces.tex}

\section{Device Tree para o DS18B20}
\label{ap3ds18b20}
\input{./SourceCodes/w1.dts.tex}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %

\chapter{Caracterização do funcionamento do servo-motor com AT89S52}
\label{apendice_servo}

\section{Simulação e ensaio em bancada}

O "ciclo" referido a seguir é o mínimo incremento do tempo em alto do sinal de controle --- baseado em simulação, o código utilizado para gerar o pulso em nível alto apresentou uma limitação de período/incremento de 20\si{\micro}s para f=12MHz, portanto o código trabalha com resolução de 20us/incremento em 12MHz. Na figura \ref{servo_wave} é apresentada a forma de onda necessária para controlar o servo motor.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.30]{./Resources/servo/wave.png}
	\captionsetup{justification=centering}
	\caption[Forma de onda de acionamento do servo-motor]{Forma de onda de acionamento do servo-motor}
	\label{servo_wave}
\end{figure}

O período T é fixo, com valor de 20ms, e o tempo em nível alto $\Delta$t é de, aprioximadamente $0,5ms < \Delta t < 2,5ms$. O objetivo da caracterização do servomotor em questão foi definir com precisão os limites de $\Delta$t. Após a simulação bem-sucedida do controle do servo motor incluso na bibloteca padrão do Proteus, o código foi efetivamente gravado no \si{\micro}C AT89S52, com f=24MHz e o motor foi excursionado até seus limites --- e além deles --- e seu comportamento foi observado e documentado, conforme é apresentado na figura \ref{excursao_servo}. O led vermelho ligado mecanicamente ao braço do servo é somente uma referência visual para a posição angular deste.

\begin{figure}[H]
	\centering
	\begin{subfigure}{.48\textwidth}
		\centering
		\includegraphics[height=5.5cm]{./Resources/servo/ciclo_26.jpg}
		\caption{Limite físico inferior}
		\label{excursao_servo:1}
	\end{subfigure}
	\begin{subfigure}{.48\textwidth}
		\centering
		\includegraphics[height=5.5cm]{./Resources/servo/ciclo_30.jpg}
		\caption{Limite de operação inferior}
		\label{excursao_servo:2}
	\end{subfigure}
	\begin{subfigure}{.48\textwidth}
		\centering
		\includegraphics[height=5.5cm]{./Resources/servo/ciclo_110.jpg}
		\caption{Limite de operação superior}
		\label{excursao_servo:3}
	\end{subfigure}
	\begin{subfigure}{.48\textwidth}
		\centering
		\includegraphics[height=5.5cm]{./Resources/servo/ciclo_114.jpg}
		\caption{Limite físico superior}
		\label{excursao_servo:4}
	\end{subfigure}
	\captionsetup{justification=centering}
	\caption[Limites de excursão do servo-motor]{Limites de excursão do servo-motor}
	\label{excursao_servo}
\end{figure}

A partir do ensaio realizado, pôde ser observado que quando funcionando muito próximo dos limites de excursão, o motor gera vibração mecânica e calor excessivos. Como a excursão máxima, em graus, é maior do que 180\si{\degree}, a faixa segura de operação foi definina para $30 < ciclo < 110$, tendo em vista que essa faixa tem uma excursão aproximada de 180\si{\degree} e está distante dos valores mínimo e máximo de excursão.

Voltando ao Proteus, ao simular o circuito, foi adicionado um osciloscópio ao pino de controle do servo motor, possibilitando a predição do tempo em alta do sinal. Três simulações para valores notáveis de "ciclo", i.e. incremento mínimo de $\Delta$t, foram feitas: para ciclo=1, determinando o offset da temporização, pois há atrasos de chamada de rotina de configuração dos temporizadores; ciclo=25, determinando o valor mínimo de operação e; ciclo=114, determinando o valor máximo de operação. Os resultados são mostrados na Figura \ref{sim_proteus}, onde é observado no osciloscópio o sinal para ciclo=1 e diversas marcações de temporização para outros valores de ciclo.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.45]{./Resources/servo/limite_menor_pulso.png}
	\captionsetup{justification=centering}
	\caption[Simulação para obtenção do valor mínimo de incremento $\Delta$t]{Simulação para obtenção do valor mínimo de incremento $\Delta$t}
	\label{sim_proteus}
\end{figure}

Diversas outras amostras de $\Delta$t foram registradas e seus valores interpolados de maneira a observar a linearidade tmin com a qual $\Delta$t é incrementado. O gráfico da Figura \ref{graph_servo_incr} apresenta os resultados.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.50]{./Resources/servo/grafico_linear.png}
	\captionsetup{justification=centering}
	\caption[Gráfico de $\Delta$t em função de \textit{ciclo}]{Gráfico de $\Delta$t em função de \textit{ciclo}}
	\label{graph_servo_incr}
\end{figure}

A partir do ensaio e da simulação aqui descritos, foram obtidos os limites de operação do servomotor TowerPro MG995 e a fórmula de $\Delta$t em função do valor do seu incremento mínimo (ciclo). A tabela \ref{limites_servo} resume os limites de temporização do servo-motor MG995.

\begin{align}
	\label{eq_varetas}
	\Delta t = (ciclo-1) \cdot t_min + offset \\
	t_min = 20\si{\micro}s \nonumber \\
	offset = 35\si{\micro}s \nonumber
\end{align}

\begin{center}
	\begin{table}[H]
		\centering
		\captionsetup{justification=centering}
		\caption[Limites de temporização do servo-motor TowerPro MG995]{Limites de temporização do servo-motor TowerPro MG995}
		\label{limites_servo}
		\begin{tabular}{ | M{10cm} | M{5cm} |}
			\hline
			\textbf{Limite} & \textbf{Valor (ms)} \\ \hline
			período mínimo & 10 \\ \hline
			excursão mínima & 0,515 \\ \hline
			excursão mínima ideal & 0,615 \\ \hline
			excursão máxima & 2,295 \\ \hline
			excursão máxima ideal & 2,215 \\ \hline
		\end{tabular}
	\end{table}
\end{center}

É importante que os limites de temporização sejam respeitados, uma vez que o motor, cuja excursão máxima é limitada mecânicamente, tenta compensá-la requisitando cada vez mais corrente da fonte, até queimar. Geralmente quando os limites são excedidos ou chegam próximos do máximo, o motor começa a vibrar e aquecer, indicando ao projetista atento que há algo errado.

\section{Código-fonte}
\input{./SourceCodes/at_servo_code.tex}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\chapter{Cálculo de OG e IBU de uma receita de cerveja}
\label{Apêndice C}

Neste apêndice é apresentado o cálculo da gravidade original (OG) e do amargor (IBU) de uma receita de cerveja, baseado em \cite{palmer}. Em primeiro lugar, é importante salientar que o cálculo da OG e do IBU dependem fortemente de dados do equipamento de produção de cerveja e/ou de constantes levantadas empiricamente, o que significa que este roteiro deve ser visto como um guia e, portanto, na necessidade de obter dados exatos, medições feitas por laboratórios especializados são necessárias.

Primeiramente é preciso calcular as unidades de ácidos alfa, que é um meio para quantificar a contribuição de amargor independentemente do tipo de lúpulo. Para isto, o peso em onças é multiplicado pela porcentagem de ácidos alfa, medida em laboratório e fornecida pelo fabricante. A fórmula para cálculo de AAU é apresentada na equação \ref{eq_aau}. Outra aplicação interessante é quando uma variaedade específica de lúpulo tem sua porcentagem de ácidos alfa diferente em anos diferentes: neste caso, sabendo a AAU da receita original, é fácil recalcular a massa necessária para adequar a receita às novas especificações.

\begin{equation}
	\label{eq_aau}
	AAU = w\cdot aa
\end{equation}

Outro parâmetro de padronização de uma cerveja é a gravidade original, que nada mais é do que a densidade do mosto após o cozimento dos grãos. Ela é baseada nos pontos de contribuição ($pts$) de cada malte, ou seja, uma transformação numérica da gravidade original do malte, que quantifica a contribuição de açúcares do malte em questão para o mosto e indicada em $g/cm^3$. O valor da gravidade original do malte é fornecido pelo fabricante geralmente em pontos, mas a equação \ref{eq_pontos} expressa o cálculo a partir do valor da densidade. Com isso é possível calcular a gravidade original do mosto, conforme descrito na equação \ref{eq_ograv}, na qual $n$ é o número de maltes empregados na receita, $\eta$ é a eficiência do equipamento, ou capacidade de extração de açúcares fermentáveis dos grãos para o mosto e V é o volume final de cerveja. Observe-se que o volume é expresso em galões e a massa em onças.

\begin{equation}
	\label{eq_pontos}
	pts_{malte} = (1-OG_{malte})\cdot 1000
\end{equation}

%How to Brew pg ~164 e pg ~59
\begin{equation}
	\label{eq_ograv}
	OG = \left\{\left[\displaystyle\sum_{n} (pts_n\cdot w_n)\right]\cdot \frac{\eta}{1000\cdot V}\right\} + 1
\end{equation}

A utilização é um dos fatores mais críticos para o cálcula adequado da quantidade de IBU da cerveja. Ela é uma função da OG e do tempo de fervura. Uma vez que seu valor é fortemente dependente do vigor da fervura, da química do mosto e de outros parâmetros difíceis de quantificar, valores empíricos de constantes são empregados como um ponto de estimação de IBU --- embora com o tempo o operador do equipamento deva fazer um ajuste fino destas constantes para aumentar a precisão do cálculo. O cálculo da utilização $u$ é apresentado no conjunto de equações \ref{eq_utilizacao}.

\begin{subequations}
	\label{eq_utilizacao}
	\begin{align}
		&u = f(OG)\cdot f(t), \quad onde:\\
		&f(OG) =  1,65\cdot 0,000125^{(OG-1)}\\
		&f(t) = \frac{1-\epsilon^{-0,04t}}{4,15}
	\end{align}
\end{subequations}

Finalmente, é possível calcular a quantidade de amargor da cerveja usando a fórmula \ref{eq_ibu}, na qual V é o volume final da produção expresso em galões e 74,89 é o fator de conversão de onças por galão para miligramas por litro, unidade do IBU.

\begin{equation}
	\label{eq_ibu}
	IBU = \frac{AAU\cdot u\cdot 74,89}{V}
\end{equation}

\section{Estimação do IBU para uma receita de 20l}

Para saber se 400g de lúpulos são suficientes para uma receita de 20 litros, foi feito um cálculo hipotético considerando situações extremas: densidade original alta ($1,120g/cm^3$), tempo de fervura alto (120min), lúpulo nobre (baixo teor de ácidos alfa = 5\%):

\begin{subequations}
	\label{eq_utilizacao}
	\begin{align}
		&AAU = (400\cdot 0,035274)\cdot 5,0 = 70,55 \nonumber\\
		&f(OG) =  1,65\cdot 0,000125^{(1,12-1,00)} = 0,56 \nonumber\\
		&f(t) = \frac{1-\epsilon^{-0,04\cdot 120}}{4,15} = 0,24 \nonumber\\
		&u = 0,56\cdot 0,24 = 0,135 \nonumber\\
		&IBU = \frac{70,55\cdot 0,135\cdot 74,89}{20\cdot 0,264} = 135 mg/l \nonumber
	\end{align}
\end{subequations}

Considerando o guia do BJCP (Beer Judge Certification Program), que é adotado por profissionais ao redor de todo o mundo para participarem de competições de cervejas como juízes, os dois estilos de cerveja com maior amargor são \textit{Imperial India Pale Ale} e \textit{American Barley Wine}, ambos com limite superior de 120 IBU \cite{styles_ibu} e o livro \textit{How to Brew} que descreve somente um estilo com mais de 120 IBU --- justamente o \textit{American Barley Wine} --- é razoável assumir que raramente será necessário operar a estrutura de adição de lúpulos em sua capacidade máxima.

\chapter{Análise do tempo de leitura do sensor DS18B20 em Python}
\label{analise_tread_temp}

\chapter{Diagrama esquemático do circuito de acionamentos de potência}
\label{esquematico_acionamentos}

\newpage

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.50]{./Resources/proteus/potenciaFolha1_menor.png}
	%\captionsetup{justification=centering}
	%\caption[Módulo do circuito de acionamentos de potência]{Módulo do circuito de acionamentos de potência}
	%\label{pot_one_module}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.50]{./Resources/proteus/potenciaFolha2_menor.png}
	%\captionsetup{justification=centering}
	%\caption[Módulo do circuito de acionamentos de potência]{Módulo do circuito de acionamentos de potência}
	%\label{pot_one_module}
\end{figure}
