\label{node_js_sec}

Para programar o código da aplicação que roda no servidor, existem diversas linguagens de programação disponíveis, geralmente de alto nível, a exemplo de PHP, Python e Node.js. Neste trabalho, a linguagem PHP foi utilizada em pequena escala, porém foi o ambiente interpretador de Javascript Node.js o escolhido para desenvolvimento da aplicação \textit{server-side}.

\subsection{Node.js}
Node.js é um ambiente em tempo de execução recente, criado em 2009 \cite{node_created}, que permite a execução no servidor --- neste caso, a BBB --- de programas escritos em Javascript. Para tal, este ambiente utiliza um motor implementado pelo Google para seu navegador Chrome --- o \textit{V8}, que compila o Javascript em código de máquina e não \textit{bytecode} ou interpretação \textit{on-the-fly}, o que torna a sua execução extremamente rápida \cite{node_fast}, embora seja importante lembrar que o \textit{overhead} inerente de lingaugens de tipagem dinâmica custa o tempo de processamento de resolução do tipo de variável utilizada \cite{node_dyntype}. 

Node, devido à natureza assíncrona de I/O do Javascript, implementa um suporte nativo à programação orientada a eventos, ainda que seja executado em uma única \textit{thread}, ou seja, diversas porções de código são multiplexadas no tempo. Isto o torna um diferencial com relação às outras lingaugens de programação mais populares, que exigem do desenvolvedor a implementação de processos de \textit{multithreading} para atingir paralelismo de processamento \cite{node_intro}. Ainda, o estilo de programação em Node é orientado a \textit{callbacks}, que nada mais é do que passar como argumento uma função que será executada assim que um evento acabar.

Historicamente, o desenvolvimento de \textit{multithreading} surgiu da necessidade de serviços de rede que possibilitassem múltiplas comunicações em paralelo, o que é conhecido como múltiplas fontes de I/O e assim será referenciado neste trabalho. Como linguagens tradicionais de programação, mais antigas, focam na implementação de aplicações operadas por um único ser humano, com o desenvolvimento da internet esta realidade mudou drasticamente, exigindo processamento de I/O massivo \cite{node_book}. Em processadores com diversos núcleos, isso significa processamento em paralelo, enquanto em processadores com um único núcleo é implementada uma multiplexação temporal que permite tal técnica. O fato mais notável das implementações de \textit{multithreading} é a complexidade do código, que não é trivial e geralmente dá origem a códigos mal estruturados e repletos de variáveis globais, difíceis de manter e muitas vezes referenciados como código espaguete \cite{node_intro, node_book}.

Javascript, que nasceu como uma linguagem para execução no cliente, tornou-se a espinha dorsal de aplicações HTML modernas e, recentemente, ficou muito popular dentre aplicações no servidor. Especificamente em Node, o comportamento assíncrono é a regra geral, devido à orientação a eventos. Isto leva programadores acostumados a linguagens síncronas como C a terem dificuldades iniciais de programação: o uso de \textit{callbacks} de evento é fundamental para estruturar a ordem com que certas tarefas são executadas, sempre após o final do evento pai \cite{node_book}. É importante salientar que este tipo de implementação ocorre de forma transparente ao desenvolvedor mas, na verdade, nada mais é do que um \textit{loop} principal cujo objetivo é cuidar de todas as chamadas a funções. Outro ponto notável relacionado ao Node é que, para executar aplicações em múltiplos núcleos, é preciso executar múltiplas instâncias, o que pode ser gerenciado com bibliotecas de suporte \cite{node_intro, node_book}. Note-se também que os termos \textit{orientado a eventos} e \textit{assíncrono} são equivalentes \cite{node_book}.

Para ilustrar o comportamento assíncrono do Node, no código da caixa \ref{wrong_node} não há garantia alguma de que a função executada na segunda linha receba um parâmetro diferente de nulo (Null) \cite{node_book}:

\lstset{language=javascript}
\begin{lstlisting}[frame=single, basicstyle=\linespread{0.85}\ttfamily, caption=Implementação incorreta de código em Node.js, label=wrong_node]
var botaoStatus = leBotao();
imprimeValorBotao(botaoStatus); //nao ha garantia de que leBotao ja acabou de ser executada
\end{lstlisting}

A maneira correta para executar este tipo de código seria usando uma função de \textit{callback}, como descrito no trecho de código da caixa \ref{right_node}, embora esta não seja a única maneira de fazê-lo. Observe-se que a função é declarada como um parâmetro de \textit{leBotao} e não tem nome --- é uma função anônima. Embora isto seja prático, do ponto de vista de manutenção de código e \textit{debug} é uma prática que deve ser evitada, uma vez que pode originar uma situação de dificuldade de manutenção de código conhecida como \textit{callback hell}, ou \textit{inferno de callbacks} \cite{callback_hell, avoid_hell}.

\lstset{language=javascript}
\begin{lstlisting}[frame=single, basicstyle=\linespread{0.85}\ttfamily, caption=Implementação de código em Node.js orientada a callback, label=right_node]
leBotao(function(botaoStatus){
	imprimeValorBotao(botaoStatus); //so acontece depois que o botao eh lido
});
\end{lstlisting}

\subsection{\textit{Node Package Manager - NPM}}

O \textit{Node Package Manager}, ou simplesmente NPM, é não somente um gerenciador de pacotes como também é um repositório de pacotes de terceiros e um padrão para definição de dependências. Seu uso não é obrigatório, mas à medida que aplicações mais complexas são desenvolvidas se torna quase mandatório, pois assim é possível usar módulos prontos para executar diversas tarefas com facilidade. Uma vantagem do NPM é que os módulos podem ser instalados localmente, restringindo-os ao diretório do projeto e, portanto, garantindo certo nível de segurança. \cite{node_book}. Na caixa \ref{install_npm_specific} é apresentado um exemplo no qual o pacote fictício \textit{meuPacote} é instalado para a versão mais recente adicionada ao repositório do NPM:

\lstset{language=bash}
\begin{lstlisting}[frame=single, basicstyle=\linespread{0.85}\ttfamily, caption=Instalação de pacote usando o NPM, label=install_npm_specific]
npm install meuPacote@latest
\end{lstlisting}

Outro exemplo de uso do NPM é a definição de dependências de um projeto e posterior possibilidade de instalação de todas elas de uma só vez. Para isto, um arquivo no formato JSON descreve estas dependências e outras informações do projeto, conforme ilustrado no exemplo da caixa \ref{describe_npm}:

\lstset{language=javascript}
\begin{lstlisting}[frame=single, basicstyle=\linespread{0.85}\ttfamily, caption=Descrição e dependências de um projeto usando NPM, label=describe_npm]
{
	"name" : "meuPacote",
	"version" : "1.0.0",
	"dependencies" : {
		"debug" : "0.3.x",
		"nano" : "*",
		"request" : ">0.2.0"
	}
}
\end{lstlisting}

E a instalação das dependências é executada conforme descrito na caixa \ref{install_npm_prj}, assumindo que o presente diretório de trabalho é o mesmo do projeto:

\lstset{language=bash}
\begin{lstlisting}[frame=single, basicstyle=\linespread{0.85}\ttfamily, caption=Instalação de dependências usando o NPM, label=install_npm_prj]
npm install
\end{lstlisting}

\subsection{\textit{MEAN Stack}}

MEAN é uma pilha de desenvolvimento (similar à amplamente difundida pilha LAMP) de código aberto, voltada para o desenvolvimento de aplicações web e que provê um conjunto de quatro ferramentas. Juntas, estas são a base necessária para a criação de aplicações tanto de servidor quanto do cliente. Cada uma das 4 letras deste acrônimo representa uma das ferramentas \cite{node_mean}:

\begin{itemize}
	\item \textbf{MongoDB} - banco de dados orientado a objetos
	\item \textbf{Express.js} - framework para criação de servidor web e roteamento
	\item \textbf{Angular.js} - framework para aplicações web
	\item \textbf{Node.js} - base da aplicação do servidor
\end{itemize}

Note-se que toda a pilha é baseada na linguagem Javascript, o que permite ao desenvolvedor de uma solução completa uma curva de aprendizado mais rápida, pois menos tempo é empregado aprendendo a sintaxe e o paradigma de programação e mais tempo dedicado à funcionalidade da aplicação em si \cite{node_mean}. Dois casos de aplicações web desenvolvidas em Node são o serviço de streaming de vídeo Netflix, que inclusive encontrou alguns problemas relacionados ao uso do framework Express \cite{node_in_flames}, e a empresa de transporte Uber \cite{uber_node}.

\subsection{Servidor Express.js}

Express é um framework de \textit{middleware} para implementação de aplicações web no servidor, incluindo mas não limitado a roteamento e operações HTTP, a exemplo dos métodos GET e POST. Embora o Node apresente um módulo dedicado a HTTP, a proposta do Express é simplificar seu uso e evitar que o mesmo trabalho seja realizado múltiplas vezes e por várias pessoas diferentes \cite{node_mean}.

Dentre as facilidades proporcionadas pelo Node está a fácil implementação de diferentes respostas para diferentes tipos de requisições baseadas no método HTTP e a renderização dinâmica de documentos HTML \cite{node_book}. O tratamento de requisições baseadas no método HTTP, possibilitado pelo Express, também é conhecido como RESTful API, que é uma API baseada no REST (\textit{Representational State Transfer}). Este por sua vez é um modelo para serviços web que implementa as operações HTTP POST, GET, PUT e DELETE, que são mapeadas como operações básicas de banco de dados: criar, ler, atualizar e deletar \cite{node_mean}.

%\subsection{Performance do Node.js}

%\subsection{Interação com código escrito em C/C++}

%\subsection{Confiabilidade e segurança quanto ao uso de módulos de terceiros}
