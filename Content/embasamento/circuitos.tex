No âmbito deste trabalho, circuitos de interface são circuitos eletrônicos que possibilitaram a interação entre a plataforma BeagleBone Black e os sensores e atuadores do sistema mecânico. O projeto adequado destes circuitos foi essencial não somente para que o projeto funcionasse corretamente, mas também para evitar que componentes do sistema, a exemplo da BBB, fossem danificados. Nesta seção, será abordada a teoria essencial para o projeto destes, desde conceitos relacionados à teoria de sinais, passando por alguns elementos básicos da eletrônica e finalizando com as características dos sensores e atuadores empregados.

\subsection{Sinais}

Sinais são funções matemáticas que guardam informações acerca de fenômenos físicos, a exemplo da temperatura de um elemento em função do tempo ou a representação do som de um instrumento musical. Na figura \ref{seno_1p} é apresentado um período de um sinal senoidal puro. Uma vez que, para obter informações a partir de um sinal, é preciso processá-lo, as mais diversas grandezas físicas devem ser convertidas para grandezas manipuláveis pelo sistema de processamento --- que no caso de circuitos eletrônicos é comumente a tensão elétrica, embora outras grandezas também sejam utilizadas \cite{sedra}. Para que a conversão de diferentes grandezas físicas em sinais elétricos seja possível, são empregados dispositivos sensores e transdutores.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.50]{./Resources/seno2.png}
	\captionsetup{justification=centering}
	\caption[Sinal senoidal em função do tempo]{Sinal senoidal em função do tempo}
	\label{seno_1p}
\end{figure}

\subsection{Dispositivos Semicondutores}

Diodos são os elementos eletrônicos mais simples, constituídos de dois terminais que estão conectados a uma junção PN, ou seja, a uma junção formada pelo contato entre dois cristais semicondutores dopados com impurezas de polaridades opostas \cite{juncoes_vero}. O efeito prático desta junção é a capacidade de retificação: quando uma DDP positiva é aplicada aos terminais do diodo conforme exposto na figura \ref{diode}, a corrente elétrica flui pelos terminais do dispositivo e diz-se que o diodo está polarizado diretamente; caso a DDP aplicada seja invertida, a corrente elétrica deixa de fluir pelo dispositivo \cite{sedra}. Este é considerado o diodo ideal, que é o modelo mais simplificado deste elemento e não leva em consideração nenhuma característica real do mesmo.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.50]{./Resources/diode.jpg}
	\captionsetup{justification=centering}
	\caption[Representação esquemática do diodo polarizado diretamente]{Representação esquemática do diodo polarizado diretamente}
	\label{diode}
\end{figure}

O diodo ideal é descrito pela equação \ref{eq_diodo_real}, na qual $I_{s}$ é a corrente de saturação reversa, $k=11600/\eta$, com $\eta$ igual a 1 para o germânio e 2 para o silício e $T_{k}$ é a temperatura em kelvin. Muitas vezes, esta curva é aproximada por um modelo conhecido como \textit{circuito equivalente linear}, composto de um diodo em série com uma fonte de tensão e um resistor, que definem o limiar de condução e o nível de resistência do dispositivo quando está conduzindo \cite{boylestad}. A figura \ref{diodo_curva} ilustra um exemplo de curva do circuito equivalente a partir da representação real. Outra modelagem é conhecida como \textit{modelo para pequenos sinais}, no qual é fixado um ponto de operação em torno do qual a excursão do sinal aplicado ao circuito é pequena, conhecido como ponto de polarização ou \textbf{ponto quiescente}. Neste modelo, a região exponencial é aproximada linearmente por um resistor cujo valor é o inverso da inclinação da reta tangente ao ponto de polarização \cite{sedra}. Cabe salientar que o avanço das ferramentas de computação tornaram possível o cálculo dos mais diversos circuitos eletrônicos de forma rápida e exata, relegando portanto os modelos simplificados a ferramentas de ensino ou para esboço de circuitos simples \cite{boylestad}, desde que os modelos empregados nas simulações sejam fiéis ao comportamento real dos componentes \cite{sedra}.

\begin{equation}
	\label{eq_diodo_real}
	I_{d}=I_{s}\epsilon ^{kV_{d}/T_{k}}-I_{s}
\end{equation}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.85]{./Resources/diodo_curva.jpg}
	\captionsetup{justification=centering}
	\caption[Definição do circuito equivalente linear, usando-se segmentos de reta para aproximar a curva característica]{Definição do circuito equivalente linear, usando-se segmentos de reta para aproximar a curva característica \\ Fonte: BOYLESTAD (2011)}
	\label{diodo_curva}
\end{figure}

A partir do conhecimento obtido com a introdução ao diodo e sua junção PN, será agora abordado o transistor bipolar de junção, também conhecido com BJT. De forma análoga ao diodo, este dispositivo é constituído da junção de três cristais semicondutores dopados, podendo ser uma junção do tipo NPN ou PNP: ambos funcionam de forma complementar, sendo que o tipo NPN conduz majoritariamente elétrons, enquanto o tipo PNP conduz majoritariamente lacunas. Na figura \ref{transistor} são apresentados os sentidos de corrente e os símbolos dos transistores PNP e NPN e, aplicando a lei das correntes de Kirchhoff, obtém-se a relação entre as correntes de emissor, coletor e base do transistor, descritas pela equação \ref{eq_bjt_kirch} \cite{boylestad}. Note-se que é usado o sentido real da corrente e não o convencional, comumente adotado em cálculos.

\begin{figure}[H]
	\centering
	\begin{subfigure}{.46\textwidth}
		\centering
		\includegraphics[height=8cm]{./Resources/bjt_pnp.jpg}
		\caption{Transistor \textit{pnp}}
		\label{transistor:1}
	\end{subfigure}
	\begin{subfigure}{.46\textwidth}
		\centering
		\includegraphics[height=8cm]{./Resources/bjt_npn.jpg}
		\caption{Transistor \textit{npn}}
		\label{transistor:2}
	\end{subfigure}
	\captionsetup{justification=centering}
	\caption[Notações e símbolos utilizados para a configuração base-comum]{Notações e símbolos utilizados para a configuração base-comum. \\Fonte: BOYLESTAD (2011)
	}
	\label{transistor}
\end{figure}

\begin{equation}
	\label{eq_bjt_kirch}
	I_{e}=I_{c} + I_{b}
\end{equation}

Para finalizar a introdução ao transistor bipolar, é apresentada uma relação simplificada entre as correntes de coletor $I_{c}$ e de base $I_{b}$ na equação \ref{eq_bjt_beta}, uma vez que esta é uma relação que permite a realização de cálculos rápidos para esboçar circuitos com transistores BJT. Cabe salientar que a validade desta relação se dá somente quando o transistor está corretamente polarizado e na região de amplificação. Outro fato que deve ser levado em conta é que o valor de $\beta$ depende das características de construção de cada BJT e é um valor cujo desvio padrão é elevado mesmo se comparados dois transistores reais do mesmo modelo \cite{boylestad}. Ainda que o conteúdo relativo a transistores BJT seja muito mais extenso e detalhado, cabe ao leitor consultar as referências bilbiográficas \cite{boylestad} e \cite{sedra} para mais detalhes acerca do tema. 

\begin{equation}
	\label{eq_bjt_beta}
	I_{c} = \beta\cdot I_{b}
\end{equation}

Existe outro tipo de transistor conhecido como transistor de efeito de campo ou FET. Embora este seja um dispositivo semelhante ao BJT no que diz respeito à aplicação, ainda assim existem inúmeras diferenças entre eles, dentre as quais a mais notável é o fato de que o BJT é controlado a corrente, enquanto o FET é controlado a tensão. Outra diferença importante é o fato de que transistores FET podem ser de canal \textit{n} ou canal \textit{p}, ou seja, são transistores unipolares --- que conduzem somente elétrons ou somente lacunas, respectivamente. Sendo um dispositivo controlado a tensão, a impedância de entrada é altíssima, muitas vezes considerada infinita em casos práticos \cite{boylestad}. Uma subclasse destes dispositivos muito popular é o MOSFET - popularmente empregado como chave eletrônica na área de circuitos integrados, mas também adotado para chaveamento de dispositivos de alta potência em função da sua baixa impedância quando ligado \cite{sedra}. O símbolo dos transistores JFET e MOSFET são apresentados na figura \ref{fet_symbol}. Os terminais do dispositivo são nomeados \textit{fonte} (\textit{source}), \textit{dreno} (\textit{drain}) e \textit{porta} (\textit{gate}).

\begin{figure}[H]
	\centering
	\begin{subfigure}{.23\textwidth}
		\centering
		\includegraphics[height=5cm]{./Resources/fet_n.jpg}
		\caption{FET canal \textit{n}}
		\label{fet_symbol:1}
	\end{subfigure}
	\begin{subfigure}{.23\textwidth}
		\centering
		\includegraphics[height=5cm]{./Resources/fet_p.jpg}
		\caption{FET canal \textit{p}}
		\label{fet_symbol:2}
	\end{subfigure}
	\begin{subfigure}{.23\textwidth}
		\centering
		\includegraphics[height=3cm]{./Resources/mosfet_n.jpg}
		\caption{MOSFET canal \textit{n}}
		\label{fet_symbol:3}
	\end{subfigure}
	\begin{subfigure}{.23\textwidth}
		\centering
		\includegraphics[height=3cm]{./Resources/mosfet_p.jpg}
		\caption{MOSFET canal \textit{p}}
		\label{fet_symbol:4}
	\end{subfigure}
	\captionsetup{justification=centering}
	\caption[Símbolos do JFET e do MOSFET]{Símbolos do JFET e do MOSFET. \\Fonte: BOYLESTAD (2011)}
	\label{fet_symbol}
\end{figure}

Os transistores do tipo FET/MOSFET são também conhecidos como resistores controlados por tensão, o que ajuda a entender seu funcionamento: assumindo que há uma DDP entre os terminais de \textit{dreno} e \textit{fonte} $V_{ds}$, a resistência à passagem de corrente por estes terminais é controlada pela tensão aplicada à \textit{porta} com relação à \textit{fonte} $V_{gs}$ do dispositivo. Quanto mais próximo de zero é a tensão, maior é o valor da resistência, para os dispositivos FET e MOSFET intensificação \cite{boylestad}. Este comportamento é ilustrado na figura \ref{curva_fet} e a equação simplificada \ref{eq_fet_id} rege o comportamento de $I_{d}$ em função de $V_{gs}$, na qual $I_{dss}$ e $V_{p}$ são os pontos notáveis no gráfico da figura \ref{curva_fet} \cite{boylestad}.

De maneira análoga ao BJT, tanto o FET quanto suas variações, aperfeiçoamentos e aplicações possuem uma teoria vasta, que não cabe a este trabalho detalhar. Para o aprofundamento no tema, recomenda-se a leitura da bilbiografia --- em especial de \cite{boylestad} e \cite{sedra}.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.38]{./Resources/curva_fet.jpg}
	\captionsetup{justification=centering}
	\caption[Obtendo a curva de transferência das curvas de dreno de um JFET]{Obtendo a curva de transferência das curvas de dreno \\ Fonte: BOYLESTAD (2011)}
	\label{curva_fet}
\end{figure}

\begin{equation}
	\label{eq_fet_id}
	I_{d} = I_{dss} \left(1 - \frac{V_{gs}}{V_{p}}\right)^2
\end{equation}

\subsection{Sensor de temperatura DS18B20}

O sensor de temperatura DS18B20, projetado pela Maxim, é um sensor digital que utiliza somente um pino de dados para comunicação com o dispositivo \textit{master}, cujas regras são estabelecidas pelo protocolo proprietário de comunicação $\textit{1-Wire}^\textregistered$ \cite{ds18b20}.

\textit{1-Wire} é um protocolo de comunicação serial \textit{half-duplex} que utiliza uma linha para transmissão de dados, além da referência. Ele é do tipo \textit{master/slave}, ou seja, um dispositivo \textit{master} inicia a comunicação e os dispositivos \textit{slave} somente respondem aos seus comandos. No caso deste protocolo específico, todo dispositivo possui um identificador de 64 bits único, dentro do qual um byte indica o tipo do dispositivo. Devido ao seu modo de funcionamento, quando a linha de dados é desconectada, os dispositivos \textit{slave} entram em estado de \textit{reset}, o que favorece seu uso em aplicações de contato. Enquanto a maioria destes dispositivos tem uma faixa de alimentação de 2,80-5,25V e não possui pino para alimentação \cite{onewire_ov} -- utilizando um sistema de alimentação parasita -- o sensor DS18B20 tem a possibilidade de alimentação parasita ou não e sua faixa tolerada para funcionamento é de 3-5,5V \cite{ds18b20}.

Uma vez que este protocolo de comunicação foi concebido para operações nas quais os dispositivos \textit{master} e \textit{slave} estão fisicamente muito próximos, alguns cuidados devem ser observados ao utilizar linhas de transmissão de longas distâncias para manter a boa performance do sistema \cite{onewire_distance}. Como o estudo da Maxim acerca das implicações do uso de linhas de longa distância negligencia este aspecto para redes com poucos dispositivos e cabeamento curto (menor que 10m), os cuidados de projeto das redes \textit{1-wire} não serão aqui especificados, deixando um aviso para trabalhos futuros que visem aplicações de longas distâncias ou com número elevado de dispositivos, a exemplo de uma microcervejaria de porte industrial.

Com relação a aspectos específicos do sensor de temperatura, este apresenta precisão de 0,5\si{\degree}C para a faixa de temperaturas de -10\si{\degree}C a +85\si{\degree}C, e de 2,0\si{\degree}C para a faixa completa de operação, de -55\si{\degree}C a +125\si{\degree}C. Quanto à resolução, esta pode ser programada de 9 a 12 bits, sendo 8 bits para a parte inteira e 1 a 4 bits decimais. O custo da melhor resolução é o aumento no tempo de conversão de uma leitura para valor digital, variando de 93,75ms a 750ms para os casos extremos \cite{ds18b20}.

A arquitetura interna do CI é apresentada na figura \ref{18b_blocos}. Nota-se que o dispositivo, por utilizar o protocolo \textit{1-Wire}, tem uma ROM de 64 bits para identificação \cite{onewire_ov}, além de uma região de memória de rascunho, que consiste de uma memória SRAM de 64 bits, dividida em 8 regiões de 1 byte, para promover a interface com as funcionalidades do CI: sensor de temperatura, alarmes programáveis para estouro de valores mínimo e máximo das medições, registrador de configuração da resolução e gerador de código CRC de 8 bits \cite{ds18b20}. A figura \ref{18b_mmap} apresenta o mapa de memória do DS18B20 -- nota-se que os registradores de configuração e alarme são copiados para uma memória não volátil (EEPROM) após configurados pelo \textit{master}, retendo seus valores mesmo em caso de corte na alimentação. Outra informação útil obtida a partir da figura \ref{18b_mmap} é o valor da temperatura lido após uma queda de alimentação, que é de +85\si{\degree} C até que o dispositivo esteja pronto para uso \cite{ds18b20}.

\begin{figure}[H]
	\centering
	\includegraphics[width=12cm]{./Resources/ds18b20-blocos.png}
	\captionsetup{justification=centering}
	\caption[Arquitetura interna do DS18B20]{Arquitetura interna do DS18B20 \\Fonte: MAXIM INTEGRATED
	}
	\label{18b_blocos}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=11.83cm]{./Resources/ds18b20-mmap.png}
	\captionsetup{justification=centering}
	\caption[Mapa de memória do DS18B20]{Mapa de memória do DS18B20. \\Fonte: MAXIM INTEGRATED
	}
	\label{18b_mmap}
\end{figure}

As leituras de temperatura são feitas em dois bytes, LSB e MSB, representados na figura \ref{18b_formato}, e que juntos são uma representação em complemento de dois, sendo que os 5 bits mais significativos são redundantes e, para resoluções menores do que 12 bits, o valor dos bits menos significativos é indefinido (1 bit indefinido para 11 bits de resolução; 2 bits indefinidos para 10 bits de resolução, etc).

\begin{figure}[H]
	\centering
	\includegraphics[width=11.83cm]{./Resources/ds18b20-formato.png}
	\captionsetup{justification=centering}
	\caption[Registradores de temperatura do DS18B20]{Registradores de temperatura do DS18B20. \\Fonte: MAXIM INTEGRATED
	}
	\label{18b_formato}
\end{figure}

O Kernel do Linux possui \textit{device drivers} que suportam parcialmente o uso do sensor DS18B20, portanto não há a necessidade de descrever em detalhes o protocolo \textit{1-Wire}. O \textit{device driver} \textit{w1-gpio} controla o barramento (\textit{master}) \textit{1-wire} utilizando a API GPIO para controlar a linha, sendo que a porta utilizada é especificada na descrição de hardware do sistema embarcado (\textit{device tree}) abordada na seção \ref{dt_section}. O \textit{device driver} \textit{w1-therm} suporta algumas famílias de sensores de temperatura da Maxim (\textit{slave}), dentre elas a DS18*20, fazendo conversões básicas de temperatura e fornecendo-as ao sistema por meio do FS (\textit{File System} ou Sistema de Arquivos). O resultado da abertura e leitura do arquivo correspondente a um sensor, é a conversão de temperatura pelo \textit{driver} e posterior fornecimento dos dados recebidos do sensor --- status da checagem do CRC e temperatura em \si{\degree}C/1000. Este driver não suporta conversão de temperatura simultânea de múltiplos sensores nem redução da precisão de conversão, portanto só são possíveis leituras de 12 bits, o que leva o acesso pelo FS a demorar cerca de 750ms. Em caso de alimentação parasita, somente um sensor pode estar conectado à linha por vez e, caso o sistema embarcado ofereça suporte a \textit{pull-up} interno, o driver é capaz de usá-lo \cite{onewire_kernel}.

%\subsection{Detector de passagem por zero}

%\subsection{\textit{Drivers} de potência}

%\subsection{Roteamento de placas de circuito impresso}
